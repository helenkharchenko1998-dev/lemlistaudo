<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .upload-area {
            border: 3px dashed #667eea;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }
        .upload-area:hover {
            border-color: #764ba2;
            background: #f8f9ff;
        }
        .upload-area.drag-over {
            border-color: #4CAF50;
            background: #f0fff0;
        }
        input[type="file"] {
            display: none;
        }
        .upload-btn {
            background: #667eea;
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s ease;
        }
        .upload-btn:hover {
            background: #764ba2;
        }
        .rules {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #667eea;
        }
        .rules h3 {
            color: #333;
            margin-bottom: 15px;
        }
        .rule-item {
            margin: 10px 0;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        .segment {
            font-weight: bold;
            color: #667eea;
        }
        .download-btn {
            background: #4CAF50;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            display: none;
            margin: 10px 5px;
            transition: background 0.3s ease;
        }
        .download-btn:hover {
            background: #45a049;
        }
        .download-btn.lemlist {
            background: #FF6B35;
        }
        .download-btn.lemlist:hover {
            background: #e55a2b;
        }
        .stats {
            display: none;
            margin: 20px 0;
            padding: 20px;
            background: #f0f8ff;
            border-radius: 10px;
        }
        .stat-item {
            display: inline-block;
            margin: 10px 20px;
            text-align: center;
        }
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }
        .stat-label {
            font-size: 14px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéØ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤</h1>
        
        <div class="upload-area" id="uploadArea">
            <p style="margin-bottom: 15px; color: #666;">–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ XLSX —Ñ–∞–π–ª —Å—é–¥–∞ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞</p>
            <button class="upload-btn" onclick="document.getElementById('fileInput').click()">
                üìÅ –í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª
            </button>
            <input type="file" id="fileInput" accept=".xlsx" />
        </div>

        <div class="rules">
            <h3>–ü—Ä–∞–≤–∏–ª–∞ —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ –ø–æ –∫–æ–ª–æ–Ω–∫–µ S (% –∏–∑–º–µ–Ω–µ–Ω–∏—è FTD):</h3>
            <div class="rule-item">
                <span class="segment">‚≠ê Stars:</span> –†–æ—Å—Ç FTD –±–æ–ª—å—à–µ 50%
            </div>
            <div class="rule-item">
                <span class="segment">üìà Growing:</span> –†–æ—Å—Ç FTD –æ—Ç 20% –¥–æ 50%
            </div>
            <div class="rule-item">
                <span class="segment">‚û°Ô∏è Stable:</span> –ò–∑–º–µ–Ω–µ–Ω–∏–µ FTD –æ—Ç -10% –¥–æ +20%
            </div>
            <div class="rule-item">
                <span class="segment">üìâ Declining:</span> –ü–∞–¥–µ–Ω–∏–µ FTD –æ—Ç -10% –¥–æ -30%
            </div>
            <div class="rule-item">
                <span class="segment">üö® Problem:</span> –ü–∞–¥–µ–Ω–∏–µ FTD –±–æ–ª—å—à–µ 30%
            </div>
        </div>

        <div class="rules" style="background: #fff3cd; border-left: 4px solid #ff6b35;">
            <h3>–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è Lemlist:</h3>
            <div style="margin: 15px 0;">
                <label for="lemlistApiKey" style="display: block; margin-bottom: 5px; font-weight: bold;">API –∫–ª—é—á Lemlist:</label>
                <input type="password" id="lemlistApiKey" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à API –∫–ª—é—á –æ—Ç Lemlist" 
                       style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; font-size: 14px;">
                <small style="color: #666; margin-top: 5px; display: block;">
                    –ù–∞–π—Ç–∏ –≤ Lemlist: Settings ‚Üí API ‚Üí Copy API key
                </small>
            </div>
        </div>

        <div class="stats" id="stats">
            <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏:</h3>
            <div id="statsContent"></div>
        </div>

        <div style="text-align: center;">
            <button class="download-btn" id="downloadBtn">
                üíæ –°–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª —Å —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–µ–π
            </button>
            
            <button class="download-btn lemlist" id="downloadLemlistBtn">
                üìß –°–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª—ã –¥–ª—è Lemlist
            </button>

            <button class="download-btn" id="createLemlistCampaignsBtn" style="background: #28a745;">
                üöÄ –°–æ–∑–¥–∞—Ç—å –∫–∞–º–ø–∞–Ω–∏–∏ –≤ Lemlist –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
            </button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
        let processedData = null;
        window.lemlistData = {}; // –î–µ–ª–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–º–∏ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∏–∑ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ —Å–æ–±—ã—Ç–∏—è
        
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const downloadBtn = document.getElementById('downloadBtn');
        const downloadLemlistBtn = document.getElementById('downloadLemlistBtn');
        const createLemlistCampaignsBtn = document.getElementById('createLemlistCampaignsBtn');
        const stats = document.getElementById('stats');
        const statsContent = document.getElementById('statsContent');

        // Drag and drop —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('drag-over');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('drag-over');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('drag-over');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                processFile(files[0]);
            }
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                processFile(e.target.files[0]);
            }
        });

        function processFile(file) {
            console.log('–ù–∞—á–∏–Ω–∞—é –æ–±—Ä–∞–±–æ—Ç–∫—É —Ñ–∞–π–ª–∞:', file.name);
            
            if (!file.name.endsWith('.xlsx')) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ XLSX —Ñ–∞–π–ª');
                return;
            }

            uploadArea.innerHTML = '<p style="color: #2196F3;">‚è≥ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é —Ñ–∞–π–ª...</p>';

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    console.log('–§–∞–π–ª –ø—Ä–æ—á–∏—Ç–∞–Ω, —Ä–∞–∑–º–µ—Ä:', e.target.result.byteLength, '–±–∞–π—Ç');
                    
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    
                    console.log('–õ–∏—Å—Ç—ã –≤ —Ñ–∞–π–ª–µ:', workbook.SheetNames);
                    
                    const sheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[sheetName];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                    
                    console.log('–î–∞–Ω–Ω—ã–µ –∏–∑–≤–ª–µ—á–µ–Ω—ã, —Å—Ç—Ä–æ–∫:', jsonData.length);
                    console.log('–ü–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞ (–∑–∞–≥–æ–ª–æ–≤–∫–∏):', jsonData[0]);
                    
                    processExcelData(jsonData);
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ñ–∞–π–ª–∞:', error);
                    uploadArea.innerHTML = '<p style="color: #f44336;">‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ñ–∞–π–ª–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –¥–ª—è –¥–µ—Ç–∞–ª–µ–π.</p>';
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ñ–∞–π–ª–∞: ' + error.message);
                }
            };
            
            reader.onerror = (error) => {
                console.error('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞:', error);
                uploadArea.innerHTML = '<p style="color: #f44336;">‚ùå –û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞</p>';
            };
            
            reader.readAsArrayBuffer(file);
        }

        function processExcelData(data) {
            console.log('–ù–∞—á–∏–Ω–∞—é –æ–±—Ä–∞–±–æ—Ç–∫—É Excel –¥–∞–Ω–Ω—ã—Ö');
            
            if (data.length === 0) {
                alert('–§–∞–π–ª –ø—É—Å—Ç–æ–π');
                uploadArea.innerHTML = '<p style="color: #f44336;">‚ùå –§–∞–π–ª –ø—É—Å—Ç–æ–π</p>';
                return;
            }

            // –ò—â–µ–º —Å—Ç—Ä–æ–∫—É —Å –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏ (–º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ –ø–µ—Ä–≤–∞—è)
            let headerRowIndex = -1;
            let headers = [];
            
            for (let i = 0; i < Math.min(10, data.length); i++) {
                const row = data[i];
                if (row && row.length > 1) {
                    console.log(`–ü—Ä–æ–≤–µ—Ä—è—é —Å—Ç—Ä–æ–∫—É ${i}:`, row);
                    
                    // –ò—â–µ–º —Å—Ç—Ä–æ–∫—É, –∫–æ—Ç–æ—Ä–∞—è —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω—É–∂–Ω—ã–µ –Ω–∞–º –∫–æ–ª–æ–Ω–∫–∏
                    const hasManagerOrEmail = row.some(cell => {
                        const cellStr = String(cell || '').toLowerCase();
                        return cellStr.includes('manager') || cellStr.includes('email') || 
                               cellStr.includes('partner') || cellStr.includes('registration');
                    });
                    
                    const hasDeltaPercent = row.some(cell => {
                        const cellStr = String(cell || '');
                        return cellStr.includes('%') && (cellStr.includes('Œî') || cellStr.includes('Œ¥') || cellStr.includes('Delta'));
                    });
                    
                    if (hasManagerOrEmail || hasDeltaPercent || row.length > 5) {
                        headerRowIndex = i;
                        headers = row.map(h => String(h || '').trim());
                        console.log(`–ù–∞–π–¥–µ–Ω–∞ —Å—Ç—Ä–æ–∫–∞ —Å –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏ –Ω–∞ –ø–æ–∑–∏—Ü–∏–∏ ${i}:`, headers);
                        break;
                    }
                }
            }
            
            if (headerRowIndex === -1) {
                alert('–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ —Å—Ç—Ä–æ–∫—É —Å –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏ –≤ –ø–µ—Ä–≤—ã—Ö 10 —Å—Ç—Ä–æ–∫–∞—Ö —Ñ–∞–π–ª–∞');
                uploadArea.innerHTML = '<p style="color: #f44336;">‚ùå –ó–∞–≥–æ–ª–æ–≤–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>';
                return;
            }

            console.log('–ù–∞–π–¥–µ–Ω–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏:', headers);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–ª–æ–Ω–∫—É S (–∏–Ω–¥–µ–∫—Å 18) - –æ–Ω–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç–æ–π –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö
            console.log(`–í—Å–µ–≥–æ –∫–æ–ª–æ–Ω–æ–∫ –≤ —Ñ–∞–π–ª–µ: ${headers.length}`);
            
            if (headers.length <= 18) {
                const allColumns = headers.map((h, i) => {
                    const letter = String.fromCharCode(65 + i); // A=65, B=66, etc
                    return `${letter}(${i}): "${h}"`;
                }).join('\n');
                
                alert(`–í —Ñ–∞–π–ª–µ –≤—Å–µ–≥–æ ${headers.length} –∫–æ–ª–æ–Ω–æ–∫, –∞ –∫–æ–ª–æ–Ω–∫–∞ S –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å 19-–π.\n\n–í—Å–µ –∫–æ–ª–æ–Ω–∫–∏:\n${allColumns}\n\n–£–∫–∞–∂–∏—Ç–µ –±—É–∫–≤—É –∫–æ–ª–æ–Ω–∫–∏ —Å –ø—Ä–æ—Ü–µ–Ω—Ç–∞–º–∏ FTD.`);
                uploadArea.innerHTML = '<p style="color: #f44336;">‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫–æ–ª–æ–Ω–æ–∫ –≤ —Ñ–∞–π–ª–µ</p>';
                return;
            }
            
            const deltaIndex = 18; // –ö–æ–ª–æ–Ω–∫–∞ S
            
            // –ö–æ–ª–æ–Ω–∫–∞ S –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç–æ–π –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö, –Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –¥–∞–Ω–Ω—ã–µ
            console.log(`–ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–æ–ª–æ–Ω–∫—É S (–∏–Ω–¥–µ–∫—Å 18): "${headers[deltaIndex] || '–±–µ–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞'}"`);

            // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–ª–æ–Ω–∫—É Segment
            const newHeaders = [...headers, 'Segment'];
            const processedData = [newHeaders];
            
            const segmentStats = {
                Stars: 0,
                Growing: 0,
                Stable: 0,
                Declining: 0,
                Problem: 0
            };

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è Lemlist
            window.lemlistData = {
                Stars: [],
                Growing: [],
                Stable: [],
                Declining: [],
                Problem: []
            };

            let processedCount = 0;
            let filteredCount = 0; // –°—á–µ—Ç—á–∏–∫ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤

            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∏–Ω–¥–µ–∫—Å—ã –Ω—É–∂–Ω—ã—Ö –∫–æ–ª–æ–Ω–æ–∫ –¥–ª—è Lemlist
            const emailIndex = findColumnIndex(headers, ['email', 'contacts']) || 5; // Fallback –Ω–∞ Contacts (–∏–Ω–¥–µ–∫—Å 5)
            const partnerNameIndex = findColumnIndex(headers, ['partner name', 'name']) || 1; // Fallback –Ω–∞ Partner name (–∏–Ω–¥–µ–∫—Å 1)  
            const managerIndex = findColumnIndex(headers, ['manager']) || 9; // Fallback –Ω–∞ Manager (–∏–Ω–¥–µ–∫—Å 9)
            
            console.log(`Email –∫–æ–ª–æ–Ω–∫–∞: ${emailIndex} ("${headers[emailIndex] || '–Ω–µ –Ω–∞–π–¥–µ–Ω–∞'}")`);
            console.log(`Partner Name –∫–æ–ª–æ–Ω–∫–∞: ${partnerNameIndex} ("${headers[partnerNameIndex] || '–Ω–µ –Ω–∞–π–¥–µ–Ω–∞'}")`);
            console.log(`Manager –∫–æ–ª–æ–Ω–∫–∞: ${managerIndex} ("${headers[managerIndex] || '–Ω–µ –Ω–∞–π–¥–µ–Ω–∞'}")`);

            // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞—á–∏–Ω–∞—è —Å–æ —Å—Ç—Ä–æ–∫–∏ 5 (headerRowIndex + 2)
            const dataStartRow = headerRowIndex + 2; // –°—Ç—Ä–æ–∫–∞ 5 –µ—Å–ª–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –≤ —Å—Ç—Ä–æ–∫–µ 3
            console.log(`–ù–∞—á–∏–Ω–∞—é –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–∞–Ω–Ω—ã—Ö —Å —Å—Ç—Ä–æ–∫–∏ ${dataStartRow + 1} (Excel)`);
            
            for (let i = dataStartRow; i < data.length; i++) {
                const row = data[i];
                if (!row || row.length === 0) continue;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º FTD –∑–∞ –ø–µ—Ä–≤—ã–π –ø–µ—Ä–∏–æ–¥ (–∫–æ–ª–æ–Ω–∫–∞ Q, –∏–Ω–¥–µ–∫—Å 16) –∏ –≤—Ç–æ—Ä–æ–π –ø–µ—Ä–∏–æ–¥ (–∫–æ–ª–æ–Ω–∫–∞ R, –∏–Ω–¥–µ–∫—Å 17)
                const ftdPeriod1 = parseFloat(row[16]) || 0; // –ö–æ–ª–æ–Ω–∫–∞ Q
                const ftdPeriod2 = parseFloat(row[17]) || 0; // –ö–æ–ª–æ–Ω–∫–∞ R
                
                // –§–∏–ª—å—Ç—Ä—É–µ–º –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤: –∏—Å–∫–ª—é—á–∞–µ–º —Ç–µ—Ö, —É –∫–æ–≥–æ FTD –º–µ–Ω—å—à–µ 5 –≤ –ª—é–±–æ–º –ø–µ—Ä–∏–æ–¥–µ
                if (ftdPeriod1 < 5 || ftdPeriod2 < 5) {
                    filteredCount++;
                    continue; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —ç—Ç–æ–≥–æ –ø–∞—Ä—Ç–Ω–µ—Ä–∞
                }
                
                const deltaValue = parseFloat(row[deltaIndex]) || 0;
                const segment = categorizeByNewDep(deltaValue);
                segmentStats[segment]++;
                processedCount++;
                
                // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è Lemlist
                const email = String(row[emailIndex] || '').trim();
                const partnerName = String(row[partnerNameIndex] || '').trim();
                const managerName = String(row[managerIndex] || '–ú–µ–Ω–µ–¥–∂–µ—Ä').trim();
                
                // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–ø–∏—Å–∏ –±–µ–∑ email
                if (!email) {
                    console.log(`–ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø–∞—Ä—Ç–Ω–µ—Ä–∞ –±–µ–∑ email –Ω–∞ —Å—Ç—Ä–æ–∫–µ ${i}`);
                    continue;
                }
                
                // –†–∞–∑–¥–µ–ª—è–µ–º –∏–º—è –Ω–∞ firstName –∏ lastName
                const nameParts = partnerName.split(' ').filter(part => part.length > 0);
                const firstName = nameParts[0] || '–ü–∞—Ä—Ç–Ω–µ—Ä';
                const lastName = nameParts.slice(1).join(' ') || '';
                
                // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–µ FTD
                const ftdChangeText = deltaValue > 0 ? `+${deltaValue}` : `${deltaValue}`;
                
                // –°–æ–∑–¥–∞–µ–º –∑–∞–ø–∏—Å—å –¥–ª—è Lemlist
                const lemlistRecord = {
                    email: email,
                    firstName: firstName,
                    lastName: lastName,
                    ftdChange: ftdChangeText,
                    ftdChangePercent: Math.abs(deltaValue),
                    managerName: managerName,
                    segment: segment,
                    ftdPeriod1: ftdPeriod1,
                    ftdPeriod2: ftdPeriod2,
                    partnerName: partnerName
                };
                
                // –î–æ–±–∞–≤–ª—è–µ–º –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Å–µ–≥–º–µ–Ω—Ç –¥–ª—è Lemlist
                window.lemlistData[segment].push(lemlistRecord);
                console.log(`–î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä—Ç–Ω–µ—Ä –≤ —Å–µ–≥–º–µ–Ω—Ç ${segment}: ${email}`);
                
                const newRow = [...row, segment];
                processedData.push(newRow);
            }

            console.log('–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤:', processedCount);
            console.log('–û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–æ –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤ (FTD < 5):', filteredCount);
            console.log('–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–µ–≥–º–µ–Ω—Ç–æ–≤:', segmentStats);

            // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –æ–±—Ä–∞—Ç–Ω–æ –≤ Excel —Ñ–æ—Ä–º–∞—Ç
            const newWorksheet = XLSX.utils.aoa_to_sheet(processedData);
            const newWorkbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(newWorkbook, newWorksheet, 'Partners');
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–∞–∫ blob –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
            window.processedWorkbook = newWorkbook;
            
            showStats(segmentStats);
            downloadBtn.style.display = 'block';
            downloadLemlistBtn.style.display = 'block';
            createLemlistCampaignsBtn.style.display = 'block';
            
            console.log('Lemlist –¥–∞–Ω–Ω—ã–µ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω—ã:', Object.keys(window.lemlistData).map(k => `${k}: ${window.lemlistData[k].length}`));
            
            uploadArea.innerHTML = `<p style="color: #4CAF50;">‚úÖ –§–∞–π–ª –æ–±—Ä–∞–±–æ—Ç–∞–Ω —É—Å–ø–µ—à–Ω–æ!<br>–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ: ${processedCount} –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤<br>–ò—Å–∫–ª—é—á–µ–Ω–æ (FTD < 5): ${filteredCount} –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤</p>`;
        }

        function findColumnIndex(headers, possibleNames) {
            for (let name of possibleNames) {
                const index = headers.findIndex(h => {
                    const headerStr = String(h || '').toLowerCase().trim();
                    const nameStr = name.toLowerCase();
                    return headerStr.includes(nameStr);
                });
                if (index !== -1) return index;
            }
            return -1;
        }

        function findNewDepColumn(headers) {
            console.log('–ò—â—É –∫–æ–ª–æ–Ω–∫—É —Å—Ä–µ–¥–∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤:', headers);
            
            // –°–Ω–∞—á–∞–ª–∞ –Ω–∞–π–¥–µ–º –∫–æ–ª–æ–Ω–∫—É "New dep"
            let newDepBaseIndex = -1;
            for (let i = 0; i < headers.length; i++) {
                const header = String(headers[i]).trim().toLowerCase();
                if (header === 'new dep') {
                    newDepBaseIndex = i;
                    console.log(`–ù–∞–π–¥–µ–Ω–∞ –±–∞–∑–æ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ "New dep" –Ω–∞ –∏–Ω–¥–µ–∫—Å–µ ${i}`);
                    break;
                }
            }
            
            if (newDepBaseIndex !== -1) {
                // –ò—â–µ–º –∫–æ–ª–æ–Ω–∫—É "Œî, %" –≤ —Å–ª–µ–¥—É—é—â–∏—Ö 3 –ø–æ–∑–∏—Ü–∏—è—Ö –ø–æ—Å–ª–µ "New dep"
                for (let j = newDepBaseIndex + 1; j < Math.min(newDepBaseIndex + 4, headers.length); j++) {
                    const header = String(headers[j]).trim();
                    console.log(`–ü—Ä–æ–≤–µ—Ä—è—é –∫–æ–ª–æ–Ω–∫—É ${j} —Ä—è–¥–æ–º —Å New dep: "${header}"`);
                    
                    if (header && header !== 'undefined' && header.includes('%')) {
                        console.log(`–ù–∞–π–¥–µ–Ω–∞ –∫–æ–ª–æ–Ω–∫–∞ —Å % –¥–ª—è New dep: –∏–Ω–¥–µ–∫—Å ${j}, –Ω–∞–∑–≤–∞–Ω–∏–µ: "${header}"`);
                        return j;
                    }
                }
            }
            
            // –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ —Ä—è–¥–æ–º —Å New dep, –∏—â–µ–º –ª—é–±—É—é –∫–æ–ª–æ–Ω–∫—É —Å "Œî, %"
            for (let i = 0; i < headers.length; i++) {
                const header = String(headers[i]).trim();
                console.log(`–ü—Ä–æ–≤–µ—Ä—è—é –∑–∞–≥–æ–ª–æ–≤–æ–∫ ${i}: "${header}" (–¥–ª–∏–Ω–∞: ${header.length})`);
                
                if (header && header !== 'undefined') {
                    // –†–∞–∑–ª–∏—á–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –ø–æ–∏—Å–∫–∞ –¥–µ–ª—å—Ç—ã
                    if (
                        header === 'Œî, %' ||           
                        header === 'Œ¥, %' ||           
                        header === 'Delta, %' ||       
                        header.includes('Œî') && header.includes('%')
                    ) {
                        console.log(`–ù–∞–π–¥–µ–Ω–∞ –∫–æ–ª–æ–Ω–∫–∞ —Å –¥–µ–ª—å—Ç–æ–π! –ò–Ω–¥–µ–∫—Å: ${i}, –Ω–∞–∑–≤–∞–Ω–∏–µ: "${header}"`);
                        return i;
                    }
                }
            }
            
            console.log('–ö–æ–ª–æ–Ω–∫–∞ —Å –¥–µ–ª—å—Ç–æ–π –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
            return -1;
        }

        function categorizeByNewDep(ftdPercent) {
            // Stars: —Ä–æ—Å—Ç FTD –±–æ–ª—å—à–µ 50%
            if (ftdPercent > 50) {
                return 'Stars';
            }
            
            // Growing: —Ä–æ—Å—Ç FTD –æ—Ç 20% –¥–æ 50%
            if (ftdPercent >= 20 && ftdPercent <= 50) {
                return 'Growing';
            }
            
            // Stable: –∏–∑–º–µ–Ω–µ–Ω–∏–µ –æ—Ç -10% –¥–æ +20%
            if (ftdPercent >= -10 && ftdPercent < 20) {
                return 'Stable';
            }
            
            // Problem: –ø–∞–¥–µ–Ω–∏–µ –±–æ–ª—å—à–µ 30%
            if (ftdPercent < -30) {
                return 'Problem';
            }
            
            // Declining: –ø–∞–¥–µ–Ω–∏–µ –æ—Ç -10% –¥–æ -30%
            return 'Declining';
        }

        function showStats(segmentStats) {
            const total = Object.values(segmentStats).reduce((a, b) => a + b, 0);
            
            statsContent.innerHTML = `
                <div class="stat-item">
                    <div class="stat-number">${segmentStats.Stars}</div>
                    <div class="stat-label">‚≠ê Stars</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">${segmentStats.Growing}</div>
                    <div class="stat-label">üìà Growing</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">${segmentStats.Stable}</div>
                    <div class="stat-label">‚û°Ô∏è Stable</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">${segmentStats.Declining}</div>
                    <div class="stat-label">üìâ Declining</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">${segmentStats.Problem}</div>
                    <div class="stat-label">üö® Problem</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">${total}</div>
                    <div class="stat-label">–í—Å–µ–≥–æ</div>
                </div>
            `;
            
            const statsElement = document.getElementById('stats');
            if (statsElement) {
                statsElement.style.display = 'block';
            }
        }

        downloadBtn.addEventListener('click', () => {
            if (window.processedWorkbook) {
                XLSX.writeFile(window.processedWorkbook, 'partners_segmented.xlsx');
            }
        });

        // –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –¥–ª—è Lemlist
        downloadLemlistBtn.addEventListener('click', () => {
            try {
                if (window.lemlistData && typeof window.lemlistData === 'object' && Object.keys(window.lemlistData).length > 0) {
                    downloadLemlistFiles();
                } else {
                    alert('–î–∞–Ω–Ω—ã–µ –¥–ª—è Lemlist –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–Ω–∞—á–∞–ª–∞ –æ–±—Ä–∞–±–æ—Ç–∞–π—Ç–µ —Ñ–∞–π–ª.');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–∏ —Ñ–∞–π–ª–æ–≤ Lemlist:', error);
                alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ñ–∞–π–ª–æ–≤: ' + error.message);
            }
        });

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∫–∞–º–ø–∞–Ω–∏–π –≤ Lemlist
        createLemlistCampaignsBtn.addEventListener('click', () => {
            const apiKey = document.getElementById('lemlistApiKey').value.trim();
            
            if (!apiKey) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ API –∫–ª—é—á –æ—Ç Lemlist');
                return;
            }
            
            if (!window.lemlistData || Object.keys(window.lemlistData).length === 0) {
                alert('–°–Ω–∞—á–∞–ª–∞ –æ–±—Ä–∞–±–æ—Ç–∞–π—Ç–µ —Ñ–∞–π–ª —Å –¥–∞–Ω–Ω—ã–º–∏ –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤');
                return;
            }
            
            createAutomatedCampaigns(apiKey);
        });

        async function createAutomatedCampaigns(apiKey) {
            const button = createLemlistCampaignsBtn;
            const originalText = button.textContent;
            
            try {
                button.textContent = '‚è≥ –°–æ–∑–¥–∞—é –∫–∞–º–ø–∞–Ω–∏–∏...';
                button.disabled = true;
                
                console.log('–û—Ç–ø—Ä–∞–≤–ª—è—é –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞–º–ø–∞–Ω–∏–π');
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞ –Ω–∞—à —Å–µ—Ä–≤–µ—Ä
                const response = await fetch('https://lemlist-automation-seven.vercel.app/api/create-campaigns', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        apiKey: apiKey,
                        partnersData: window.lemlistData
                    })
                });
                
                const result = await response.json();
                
                button.textContent = originalText;
                button.disabled = false;
                
                if (result.success) {
                    const successfulCampaigns = result.results.filter(r => r.success);
                    const failedCampaigns = result.results.filter(r => !r.success);
                    
                    let message = `üéâ –£—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–æ ${successfulCampaigns.length} –∫–∞–º–ø–∞–Ω–∏–π –≤ Lemlist!\n\n`;
                    
                    successfulCampaigns.forEach(campaign => {
                        message += `‚úÖ ${campaign.segment}: ${campaign.partnersCount} –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤\n`;
                    });
                    
                    if (failedCampaigns.length > 0) {
                        message += `\n‚ö†Ô∏è –û—à–∏–±–∫–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ ${failedCampaigns.length} –∫–∞–º–ø–∞–Ω–∏–π:\n`;
                        failedCampaigns.forEach(campaign => {
                            message += `‚ùå ${campaign.segment}: ${campaign.error}\n`;
                        });
                    }
                    
                    message += '\n–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–∞—à –∞–∫–∫–∞—É–Ω—Ç Lemlist - –∫–∞–º–ø–∞–Ω–∏–∏ –≥–æ—Ç–æ–≤—ã –∫ –∑–∞–ø—É—Å–∫—É!';
                    alert(message);
                } else {
                    alert(`‚ùå –û—à–∏–±–∫–∞: ${result.error}`);
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–∞–º–ø–∞–Ω–∏–π:', error);
                button.textContent = originalText;
                button.disabled = false;
                
                // Fallback –Ω–∞ —Å—Ç–∞—Ä—ã–π –º–µ—Ç–æ–¥, –µ—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
                alert('–°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ CSV —Ñ–∞–π–ª –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞.');
            }
        }

        function downloadLemlistFiles() {
            console.log('–ù–∞—á–∏–Ω–∞—é —Å–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –¥–ª—è Lemlist');
            
            // –°–æ–∑–¥–∞–µ–º –æ–¥–∏–Ω –±–æ–ª—å—à–æ–π CSV —Ñ–∞–π–ª —Å–æ –≤—Å–µ–º–∏ —Å–µ–≥–º–µ–Ω—Ç–∞–º–∏
            let allData = [];
            let totalRecords = 0;
            
            Object.keys(window.lemlistData).forEach(segment => {
                const data = window.lemlistData[segment];
                if (data.length > 0) {
                    allData = allData.concat(data);
                    totalRecords += data.length;
                }
            });
            
            if (allData.length > 0) {
                // –°–æ–∑–¥–∞–µ–º –µ–¥–∏–Ω—ã–π CSV —Ñ–∞–π–ª
                const csvContent = convertToCSV(allData);
                
                // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —Å–∫–∞—á–∏–≤–∞–µ–º CSV —á–µ—Ä–µ–∑ —Å–æ–∑–¥–∞–Ω–∏–µ —Å—Å—ã–ª–∫–∏
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.style.display = 'none';
                a.href = url;
                a.download = 'partners_for_lemlist.csv';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                alert(`–°–∫–∞—á–∞–Ω —Ñ–∞–π–ª: partners_for_lemlist.csv\n–í –Ω–µ–º ${totalRecords} –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤ –≥–æ—Ç–æ–≤—ã—Ö –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ –≤ Lemlist!\n\n–ö–æ–ª–æ–Ω–∫–∏ —Ñ–∞–π–ª–∞:\n- email\n- firstName, lastName\n- ftdChange (–ø—Ä–æ—Ü–µ–Ω—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è)\n- managerName\n- segment (Stars/Growing/etc)\n- ftdPeriod1, ftdPeriod2`);
            } else {
                alert('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞');
            }
        }

        function convertToCSV(data) {
            if (data.length === 0) return '';
            
            const headers = Object.keys(data[0]);
            const csvRows = [headers.join(',')];
            
            data.forEach(row => {
                const values = headers.map(header => {
                    const value = row[header] || '';
                    // –≠–∫—Ä–∞–Ω–∏—Ä—É–µ–º –∑–∞–ø—è—Ç—ã–µ –∏ –∫–∞–≤—ã—á–∫–∏
                    return typeof value === 'string' && value.includes(',') ? `"${value}"` : value;
                });
                csvRows.push(values.join(','));
            });
            
            return csvRows.join('\n');
        }

        function downloadCSV(content, filename) {
            try {
                console.log(`–ü—ã—Ç–∞—é—Å—å —Å–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª: ${filename}`);
                const blob = new Blob([content], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = filename;
                link.style.display = 'none';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                console.log(`–§–∞–π–ª ${filename} —Å–∫–∞—á–∞–Ω —É—Å–ø–µ—à–Ω–æ`);
                return true;
            } catch (error) {
                console.error(`–û—à–∏–±–∫–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è ${filename}:`, error);
                return false;
            }
        }

        function downloadEmailTemplates() {
            const templates = `–®–ê–ë–õ–û–ù–´ –ü–ò–°–ï–ú –î–õ–Ø LEMLIST

=== STARS (–†–æ—Å—Ç >50%) ===
–¢–µ–º–∞: {{firstName}}, —Ç—ã –ø—Ä–æ—Å—Ç–æ –∫—Ä–∞—Å–∞–≤—á–∏–∫! üöÄ

–ü—Ä–∏–≤–µ—Ç {{firstName}}!

–¢–≤–æ–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ FTD –≤—ã—Ä–æ—Å–ª–∏ –Ω–∞ {{ftdChange}}% - —ç—Ç–æ —Ñ–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞!

–ü–æ–∫–∞–∑–∞—Ç–µ–ª–∏:
‚Ä¢ –ü–µ—Ä–≤—ã–π –ø–µ—Ä–∏–æ–¥: {{ftdPeriod1}} FTD
‚Ä¢ –í—Ç–æ—Ä–æ–π –ø–µ—Ä–∏–æ–¥: {{ftdPeriod2}} FTD
‚Ä¢ –†–æ—Å—Ç: {{ftdChange}}%

–•–æ—á—É –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å:
‚Ä¢ –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–µ —Å—Ç–∞–≤–∫–∏ –¥–ª—è —Ç–≤–æ–µ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞
‚Ä¢ –≠–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã
‚Ä¢ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—É—é –ø–æ–¥–¥–µ—Ä–∂–∫—É

–î–∞–≤–∞–π –æ–±—Å—É–¥–∏–º, –∫–∞–∫ –µ—â–µ –±–æ–ª—å—à–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å —Ç–≤–æ–π —É—Å–ø–µ—Ö?

–° —É–≤–∞–∂–µ–Ω–∏–µ–º,
{{managerName}}

=== GROWING (–†–æ—Å—Ç 20-50%) ===
–¢–µ–º–∞: {{firstName}}, –æ—Ç–ª–∏—á–Ω–∞—è –¥–∏–Ω–∞–º–∏–∫–∞! üìà

–ü—Ä–∏–≤–µ—Ç {{firstName}}!

–í–∏–∂—É –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—É—é –¥–∏–Ω–∞–º–∏–∫—É –≤ —Ç–≤–æ–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö - —Ä–æ—Å—Ç –Ω–∞ {{ftdChange}}%!

–ü–æ–∫–∞–∑–∞—Ç–µ–ª–∏:
‚Ä¢ –ü–µ—Ä–≤—ã–π –ø–µ—Ä–∏–æ–¥: {{ftdPeriod1}} FTD
‚Ä¢ –í—Ç–æ—Ä–æ–π –ø–µ—Ä–∏–æ–¥: {{ftdPeriod2}} FTD

–¢—ã –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø—É—Ç–∏! –ï—Å—Ç—å –∏–¥–µ–∏, –∫–∞–∫ —É—Å–∫–æ—Ä–∏—Ç—å —Ä–æ—Å—Ç –µ—â–µ –±–æ–ª—å—à–µ.

–ù–∞–ø–∏—à–∏ –º–Ω–µ, –æ–±—Å—É–¥–∏–º —Å—Ç—Ä–∞—Ç–µ–≥–∏—é.

–° —É–≤–∞–∂–µ–Ω–∏–µ–º,
{{managerName}}

=== DECLINING (–ü–∞–¥–µ–Ω–∏–µ 10-30%) ===
–¢–µ–º–∞: {{firstName}}, –¥–∞–≤–∞–π —Ä–∞–∑–±–µ—Ä–µ–º —Å–∏—Ç—É–∞—Ü–∏—é

–ü—Ä–∏–≤–µ—Ç {{firstName}},

–ó–∞–º–µ—Ç–∏–ª –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ç–≤–æ–∏—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è—Ö - —Å–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞ {{ftdChangePercent}}%.

–ü–æ–∫–∞–∑–∞—Ç–µ–ª–∏:
‚Ä¢ –ü–µ—Ä–≤—ã–π –ø–µ—Ä–∏–æ–¥: {{ftdPeriod1}} FTD
‚Ä¢ –í—Ç–æ—Ä–æ–π –ø–µ—Ä–∏–æ–¥: {{ftdPeriod2}} FTD

–¢–∞–∫–æ–µ –±—ã–≤–∞–µ—Ç, –≥–ª–∞–≤–Ω–æ–µ - –±—ã—Å—Ç—Ä–æ –Ω–∞–π—Ç–∏ —Ä–µ—à–µ–Ω–∏–µ. –£ –º–µ–Ω—è –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏–¥–µ–π:
‚Ä¢ –ù–æ–≤—ã–µ –∫—Ä–µ–∞—Ç–∏–≤—ã
‚Ä¢ –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –ª–µ–Ω–¥–∏–Ω–≥–∏
‚Ä¢ –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∞—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è

–î–∞–≤–∞–π —Å–æ–∑–≤–æ–Ω–∏–º—Å—è –Ω–∞ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ?

–° —É–≤–∞–∂–µ–Ω–∏–µ–º,
{{managerName}}

=== PROBLEM (–ü–∞–¥–µ–Ω–∏–µ >30%) ===
–¢–µ–º–∞: {{firstName}}, –Ω—É–∂–Ω–∞ —Å—Ä–æ—á–Ω–∞—è –ø–æ–º–æ—â—å!

–ü—Ä–∏–≤–µ—Ç {{firstName}},

–í–∏–∂—É, —á—Ç–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–∏–ª—å–Ω–æ –ø—Ä–æ—Å–µ–ª–∏ - –ø–∞–¥–µ–Ω–∏–µ –Ω–∞ {{ftdChangePercent}}%. –ù–µ –ø–µ—Ä–µ–∂–∏–≤–∞–π, —Ç–∞–∫–∏–µ –ø–µ—Ä–∏–æ–¥—ã —Å–ª—É—á–∞—é—Ç—Å—è —É –≤—Å–µ—Ö.

–ü–æ–∫–∞–∑–∞—Ç–µ–ª–∏:
‚Ä¢ –ü–µ—Ä–≤—ã–π –ø–µ—Ä–∏–æ–¥: {{ftdPeriod1}} FTD
‚Ä¢ –í—Ç–æ—Ä–æ–π –ø–µ—Ä–∏–æ–¥: {{ftdPeriod2}} FTD

–ü—Ä–µ–¥–ª–∞–≥–∞—é —Å—Ä–æ—á–Ω—É—é –≤—Å—Ç—Ä–µ—á—É, —á—Ç–æ–±—ã:
‚Ä¢ –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏—á–∏–Ω—ã
‚Ä¢ –°–æ—Å—Ç–∞–≤–∏—Ç—å –ø–ª–∞–Ω –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
‚Ä¢ –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –ø–æ–¥–¥–µ—Ä–∂–∫—É

–Ø –ª–∏—á–Ω–æ –∑–∞–π–º—É—Å—å —Ç–≤–æ–∏–º –∫–µ–π—Å–æ–º. –ó–≤–æ–Ω–∏ –≤ –ª—é–±–æ–µ –≤—Ä–µ–º—è.

–° —É–≤–∞–∂–µ–Ω–∏–µ–º,
{{managerName}}

=== STABLE (–°—Ç–∞–±–∏–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã) ===
–¢–µ–º–∞: {{firstName}}, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å

–ü—Ä–∏–≤–µ—Ç {{firstName}}!

–¢–≤–æ–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å—Ç–∞–±–∏–ª—å–Ω—ã ({{ftdChange}}%) - —ç—Ç–æ —Ö–æ—Ä–æ—à–æ –≤ —Ç–µ–∫—É—â–∏—Ö —É—Å–ª–æ–≤–∏—è—Ö —Ä—ã–Ω–∫–∞.

–ü–æ–∫–∞–∑–∞—Ç–µ–ª–∏:
‚Ä¢ –ü–µ—Ä–≤—ã–π –ø–µ—Ä–∏–æ–¥: {{ftdPeriod1}} FTD
‚Ä¢ –í—Ç–æ—Ä–æ–π –ø–µ—Ä–∏–æ–¥: {{ftdPeriod2}} FTD

–ü—Ä–µ–¥–ª–∞–≥–∞—é –æ–±—Å—É–¥–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–ª—è —Ä–æ—Å—Ç–∞:
‚Ä¢ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø–æ–¥—Ö–æ–¥–æ–≤
‚Ä¢ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ç–µ–∫—É—â–∏—Ö –∫–∞–º–ø–∞–Ω–∏–π
‚Ä¢ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –±–æ–Ω—É—Å—ã

–ù–∞–ø–∏—à–∏, –µ—Å–ª–∏ –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã!

–° —É–≤–∞–∂–µ–Ω–∏–µ–º,
{{managerName}}`;

            return downloadCSV(templates, 'email_templates_lemlist.txt');
        }
    </script>
</body>
</html>
